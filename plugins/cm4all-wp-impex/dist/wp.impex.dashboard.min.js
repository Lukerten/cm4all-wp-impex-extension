var wp=wp||{};wp.impex=wp.impex||{};wp.impex.dashboard=(()=>{var ue=Object.create;var te=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var xe=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var we=r=>te(r,"__esModule",{value:!0});var he=(r,a)=>()=>(a||r((a={exports:{}}).exports,a),a.exports);var ge=(r,a,i)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of xe(a))!ye.call(r,s)&&s!=="default"&&te(r,s,{get:()=>a[s],enumerable:!(i=ce(a,s))||i.enumerable});return r},ve=r=>ge(we(te(r!=null?ue(be(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var ne=he((Xr,G)=>{(function(){"use strict";var r={}.hasOwnProperty;function a(){for(var i=[],s=0;s<arguments.length;s++){var p=arguments[s];if(!!p){var w=typeof p;if(w==="string"||w==="number")i.push(p);else if(Array.isArray(p)){if(p.length){var x=a.apply(null,p);x&&i.push(x)}}else if(w==="object")if(p.toString===Object.prototype.toString)for(var h in p)r.call(p,h)&&p[h]&&i.push(h);else i.push(p.toString())}}return i.join(" ")}typeof G!="undefined"&&G.exports?(a.default=a,G.exports=a):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return a}):window.classNames=a})()});var m=window.wp.element,{Platform:Ie,RawHTML:Be,createInterpolateElement:Ae,renderToString:Me,Children:Ne,Component:He,Fragment:je,StrictMode:Te,Suspense:qe,cloneElement:Ue,concatChildren:ze,createContext:Ve,createElement:f,createRef:_e,forwardRef:$e,isValidElement:Oe,lazy:Ge,memo:We,switchChildrenNodeName:Je,useCallback:Ye,useContext:Ke,useDebugValue:Qe,useEffect:Xe,useImperativeHandle:Ze,useLayoutEffect:er,useMemo:rr,useReducer:tr,useRef:or,useState:ar,createPortal:lr,findDOMNode:ir,render:sr,unmountComponentAtNode:nr,isEmptyElement:pr}=window.wp.element;var C=window.wp.impex.debug;var t=window.wp.components;var ur=window.wp.i18n,{__:o,_n:cr,_nx:xr,_x:br,defaultI18n:yr,getLocaleData:wr,hasTranslation:hr,isRTL:gr,resetLocaleData:vr,setLocaleData:Cr,sprintf:Sr,subscribe:Pr,createI18n:kr}=window.wp.i18n;var N=window.wp.apiFetch;var $=window.wp.hooks,{actions:Lr,addAction:Fr,addFilter:Er,applyFilters:Ir,createHooks:Br,currentAction:Ar,currentFilter:Mr,defaultHooks:Nr,didAction:Hr,didFilter:jr,doAction:Tr,doingAction:qr,doingFilter:Ur,filters:zr,hasAction:Vr,hasFilter:_r,removeAction:$r,removeAllActions:Or,removeAllFilters:Gr,removeFilter:Wr}=window.wp.hooks;var O=window.wp.url;var S=window.wp.data;var E=window.wp.impex.filters;var pe=ve(ne());var b=r=>f("path",r);var y=r=>{let{className:a,isPressed:i,...s}=r,p={...s,className:(0,pe.default)(a,{"is-pressed":i})||void 0,role:"img","aria-hidden":!0,focusable:!1};return f("svg",p)};var Ce=f(y,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},f(b,{d:"M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21ZM15.5303 8.46967C15.8232 8.76256 15.8232 9.23744 15.5303 9.53033L13.0607 12L15.5303 14.4697C15.8232 14.7626 15.8232 15.2374 15.5303 15.5303C15.2374 15.8232 14.7626 15.8232 14.4697 15.5303L12 13.0607L9.53033 15.5303C9.23744 15.8232 8.76256 15.8232 8.46967 15.5303C8.17678 15.2374 8.17678 14.7626 8.46967 14.4697L10.9393 12L8.46967 9.53033C8.17678 9.23744 8.17678 8.76256 8.46967 8.46967C8.76256 8.17678 9.23744 8.17678 9.53033 8.46967L12 10.9393L14.4697 8.46967C14.7626 8.17678 15.2374 8.17678 15.5303 8.46967Z"})),P=Ce;var Se=f(y,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},f(b,{d:"M17.3 10.1c0-2.5-2.1-4.4-4.8-4.4-2.2 0-4.1 1.4-4.6 3.3h-.2C5.7 9 4 10.7 4 12.8c0 2.1 1.7 3.8 3.7 3.8h9c1.8 0 3.2-1.5 3.2-3.3.1-1.6-1.1-2.9-2.6-3.2zm-.5 5.1h-4v-2.4L14 14l1-1-3-3-3 3 1 1 1.2-1.2v2.4H7.7c-1.2 0-2.2-1.1-2.2-2.3s1-2.4 2.2-2.4H9l.3-1.1c.4-1.3 1.7-2.2 3.2-2.2 1.8 0 3.3 1.3 3.3 2.9v1.3l1.3.2c.8.1 1.4.9 1.4 1.8 0 1-.8 1.8-1.7 1.8z"})),W=Se;var Pe=f(y,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},f(b,{d:"M18 11.3l-1-1.1-4 4V3h-1.5v11.3L7 10.2l-1 1.1 6.2 5.8 5.8-5.8zm.5 3.7v3.5h-13V15H4v5h16v-5h-1.5z"})),J=Pe;var ke=f(y,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},f(b,{d:"M20.1 5.1L16.9 2 6.2 12.7l-1.3 4.4 4.5-1.3L20.1 5.1zM4 20.8h8v-1.5H4v1.5z"})),oe=ke;var k=oe;var Re=f(y,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},f(b,{d:"M18.5 15v3.5H13V6.7l4.5 4.1 1-1.1-6.2-5.8-5.8 5.8 1 1.1 4-4v11.7h-6V15H4v5h16v-5z"})),Y=Re;function H({title:r,doSave:a,item:i,onRequestClose:s}){let[p,w]=m.useState(i.name),[x,h]=m.useState(i.description),R=async()=>{await a({name:p,description:x}),s()};return window.wp.element.createElement(t.Modal,{title:r,icon:k,onRequestClose:()=>s()},window.wp.element.createElement(t.TextControl,{label:o("Name","cm4all-wp-impex"),help:o("Name should be short and human readable","cm4all-wp-impex"),value:p,onChange:w}),window.wp.element.createElement(t.TextareaControl,{label:o("Description","cm4all-wp-impex"),help:o("Description may contain more expressive information describing the item","cm4all-wp-impex"),value:x,onChange:h}),window.wp.element.createElement(t.Button,{variant:"primary",onClick:R,disabled:p===i.name&&x===i.description},"Save"))}function K({title:r,doDelete:a,onRequestClose:i,children:s}){let p=async()=>{await a(),i()};return window.wp.element.createElement(t.Modal,{title:r,icon:P,onRequestClose:()=>i()},window.wp.element.createElement("p",null,s),window.wp.element.createElement(t.Button,{variant:"primary",isDestructive:!0,onClick:p},"Delete"))}var me=m.createContext();function j(){return m.useContext(me)}ScreenContext={normalizeFilename(r){return r.replace(/[^a-z0-9\-_]/gi,"_").replace(/(-+)|(_+)/gi,a=>a[0]).toLowerCase().slice(-32)},currentDateString(){let r=new Date;return`${r.getFullYear()}-${("0"+(r.getMonth()+1)).slice(-2)}-${("0"+r.getDate()).slice(-2)}-${r.getHours()}-${r.getMinutes()}-${r.getSeconds()}`}};function de({children:r}){return window.wp.element.createElement(me.Provider,{value:ScreenContext},r)}var I=window.wp.impex.store;var Q=C.default("wp.impex.dashboard.export");Q("loaded");function ae(){let{settings:r,exportProfiles:a,exports:i}=S.useSelect(l=>{let e=l(I.KEY);return{settings:e.getSettings(),exportProfiles:e.getExportProfiles(),exports:e.getExports()}}),[s,p]=m.useState(),w=m.useRef(),x=(l=null)=>{let e=a.find(n=>n.name===l);p(e),w.current.title=e?.description};m.useEffect(()=>{x(a?.[0]?.name)},[a]);let{createExport:h,updateExport:R,deleteExport:B}=S.useDispatch(I.KEY),[L,g]=m.useState(null),[T,v]=m.useState(null),q=j();console.log({exportProfile:s,exportProfiles:a});let{currentUser:U}=S.useSelect(l=>({currentUser:l("core").getCurrentUser()})),z=async()=>{let l=new URL(r.site_url),e=q.currentDateString(),n=`${l.hostname}-${s.name}-${e}`,d=`Export '${s.name}' created by user '${U.name}' at ${e}`;v({component:window.wp.element.createElement(t.Modal,{title:o("Creating snapshot","cm4all-wp-impex"),onRequestClose:()=>{},overlayClassName:"blocking"},window.wp.element.createElement("progress",{indeterminate:"true"}))}),await h(s,n,d),v()},V=async(l,e,n)=>{let d=await e;Q("_saveSlicesChunk(chunk=%o) : %o",n,e);let u=await l.getDirectoryHandle(`chunk-${n.toString().padStart(4,"0")}`,{create:!0});return Promise.all(d.map(async(c,F)=>{let A=await u.getFileHandle(`slice-${F.toString().padStart(4,"0")}.json`,{create:!0});c=await $.applyFilters(E.SLICE_REST_UNMARSHAL,E.NAMESPACE,c,F,u);let D=await A.createWritable();await D.write(JSON.stringify(c,null,"  ")),Q("slice(=%o) = %o",F,c),await D.close()}))},Z=async l=>{let e=null;try{e=q.normalizeFilename(l.name)}catch{return}let d=await(await window.showDirectoryPicker({startIn:"downloads",id:e})).getDirectoryHandle(e,{create:!0});Q("download export %o",l);let u=`${r.base_uri}/export/${l.id}/slice`;v({component:window.wp.element.createElement(t.Modal,{title:o("Downloading snapshot","cm4all-wp-impex"),onRequestClose:()=>{},overlayClassName:"blocking"},window.wp.element.createElement("progress",{indeterminate:"true"}))});let c=await N({path:u,parse:!1}),F=Number.parseInt(c.headers.get("X-WP-Total"),10),A=Number.parseInt(c.headers.get("X-WP-TotalPages")),D=[V(d,c.json(),1)];for(let M=2;M<=A;M++)D.push(V(d,N({path:O.addQueryArgs(u,{page:M})}),M));await Promise.all(D),v(null)};return window.wp.element.createElement(window.wp.element.Fragment,null,window.wp.element.createElement(t.Panel,{className:"export",header:o("Export","cm4all-wp-impex")},window.wp.element.createElement(t.PanelBody,{title:o("Create snapshot","cm4all-wp-impex"),opened:!0,className:"create-export-form"},window.wp.element.createElement(wp.components.SelectControl,{ref:w,disabled:!a.length,label:o("Export Profile","cm4all-wp-impex"),value:s?.name,onChange:l=>x(l),options:[{name:o("Select an Export profile","cm4all-wp-impex"),disabled:!0},...a].map(l=>({value:l.disabled?void 0:l.name,label:l.name,disabled:l.disabled})),help:o("Export profiles define which WordPress data should be extracted to the snapshot","cm4all-wp-impex")}),window.wp.element.createElement(t.Button,{isPrimary:!0,onClick:z,disabled:!a.find(l=>l.name===s?.name)},o("Create Snapshot","cm4all-wp-impex"))),i.map((l,e)=>window.wp.element.createElement(t.PanelBody,{key:l.id,title:l.name,initialOpen:e===0},window.wp.element.createElement(t.PanelRow,null,window.wp.element.createElement(t.Button,{isSecondary:!0,onClick:()=>Z(l),icon:J},o("Download snapshot","cm4all-wp-impex")),window.wp.element.createElement(t.DropdownMenu,{label:o("Additional actions on this export","cm4all-wp-impex"),controls:[{title:o("Edit","cm4all-wp-impex"),icon:k,onClick:()=>g({component:H,props:{title:o("Edit export","cm4all-wp-impex"),async doSave(n){await R(l.id,n)},item:l}})},{title:o("Delete","cm4all-wp-impex"),icon:P,onClick:()=>g({component:K,props:{title:o("Delete export","cm4all-wp-impex"),children:window.wp.element.createElement(window.wp.element.Fragment,null,o("Are you really sure to delete export"),window.wp.element.createElement("code",null,l.name),"?"),async doDelete(){await B(l.id)}}})}]})),window.wp.element.createElement(t.PanelRow,null,window.wp.element.createElement("pre",null,JSON.stringify(l,null,"  ")))))),L&&window.wp.element.createElement(L.component,{...L.props,onRequestClose:g}),T&&window.wp.element.createElement(t.Fill,{name:"progress",onRequestClose:()=>{}},T.component))}var X=C.default("wp.impex.dashboard.import");X("loaded");function le(){let{currentUser:r}=S.useSelect(e=>({currentUser:e("core").getCurrentUser()})),{settings:a,importProfiles:i,imports:s}=S.useSelect(e=>{let n=e(I.KEY);return{settings:n.getSettings(),importProfiles:n.getImportProfiles(),imports:n.getImports()}}),{createImport:p,updateImport:w,deleteImport:x,consumeImport:h}=S.useDispatch(I.KEY),[R,B]=m.useState(null),[L,g]=m.useState(null),T=j(),[v,q]=m.useState(),U=m.useRef(),z=(e=null)=>{let n=i.find(d=>d.name===e);q(n),U.current.title=n?.description};m.useEffect(()=>{z(i?.[0]?.name)},[i]);let V=async e=>{X("onConsumeImport(%o)",e),g({component:window.wp.element.createElement(t.Modal,{title:o("Importing data into WordPress ...","cm4all-wp-impex"),onRequestClose:()=>{},overlayClassName:"blocking"},window.wp.element.createElement("progress",{indeterminate:"true"}))}),await h(e.id,{},null,null),g()},Z=async e=>{let n=[];for await(let d of e.values())if(d.kind==="directory")for await(let u of d.values())u.kind==="file"&&u.name.match(/^slice-\d+\.json$/)&&n.push({fileHandle:u,dirHandle:d});return n.sort((d,u)=>{let c=d.dirHandle.name.localeCompare(u.dirHandle.name);return c===0?d.fileHandle.name.localeCompare(u.fileHandle.name):c}),n},l=async()=>{let e=null;try{e=await window.showDirectoryPicker({startIn:"downloads"})}catch{return}X("upload export %o",e.name);let n=T.currentDateString(),d=e.name,u=`Import '${e.name}' created by user '${r.name}' at ${n}`;g({component:window.wp.element.createElement(t.Modal,{title:o("Uploading snapshot","cm4all-wp-impex"),onRequestClose:()=>{},overlayClassName:"blocking"},window.wp.element.createElement("progress",{indeterminate:"true"}))});let c=(await p(d,u,v,[])).payload,F=await Z(e),A=`${a.base_uri}/import/${c.id}/slice`,D=F.map(async({fileHandle:ee,dirHandle:ie},se)=>{let re=new FormData,_=JSON.parse(await(await ee.getFile()).text());if(_=await $.applyFilters(E.SLICE_REST_UPLOAD,E.NAMESPACE,_,parseInt(ee.name.match(/^slice-(\d+)\.json$/)[1]),ie,re),_)return X("upload %o",{position:se,file:ee.name,dir:ie.name}),re.append("slice",JSON.stringify(_,null,"  ")),N({method:"POST",path:O.addQueryArgs(A,{position:se}),body:re,parse:!1})}),M=await Promise.all(D);g()};return window.wp.element.createElement(window.wp.element.Fragment,null,window.wp.element.createElement(t.Panel,{className:"import",header:o("Import","cm4all-wp-impex")},window.wp.element.createElement(t.PanelBody,{title:o("Upload snapshot to Wordpress","cm4all-wp-impex"),opened:!0,className:"upload-import-form"},window.wp.element.createElement(wp.components.SelectControl,{ref:U,disabled:!i.length,label:o("Import Profile","cm4all-wp-impex"),value:v?.name,onChange:e=>z(e),options:[{name:o("Select an Import profile","cm4all-wp-impex"),disabled:!0},...i].map(e=>({value:e.disabled?void 0:e.name,label:e.name,disabled:e.disabled})),help:o("Import profiles define which WordPress data should be consumed from the snapshot","cm4all-wp-impex")}),window.wp.element.createElement(t.Button,{isPrimary:!0,onClick:l,icon:Y,disabled:!v},o("Upload snapshot","cm4all-wp-impex"))),s.map((e,n)=>window.wp.element.createElement(t.PanelBody,{key:e.id,title:e.name,initialOpen:n===0},window.wp.element.createElement(t.PanelRow,null,window.wp.element.createElement(t.Button,{isDestructive:!0,isPrimary:!0,onClick:()=>V(e),icon:W},o("Import uploaded snapshot","cm4all-wp-impex")),window.wp.element.createElement(t.DropdownMenu,{label:o("Additional actions on this import","cm4all-wp-impex"),controls:[{title:o("Edit","cm4all-wp-impex"),icon:k,onClick:()=>B({component:H,props:{title:o("Edit import snapshot","cm4all-wp-impex"),async doSave(d){await w(e.id,d)},item:e}})},{title:o("Delete","cm4all-wp-impex"),icon:P,onClick:()=>B({component:K,props:{title:o("Delete import","cm4all-wp-impex"),children:window.wp.element.createElement(window.wp.element.Fragment,null,o("Are you really sure to delete import","cm4all-wp-impex"),window.wp.element.createElement("code",null,e.name),"?"),async doDelete(){await x(e.id)}}})}]})),window.wp.element.createElement(t.PanelRow,null,window.wp.element.createElement("pre",{style:{overflow:"auto"}},JSON.stringify(e,null,"  ")))))),R&&window.wp.element.createElement(R.component,{...R.props,onRequestClose:B}),L&&window.wp.element.createElement(t.Fill,{name:"progress",onRequestClose:()=>{}},L.component))}var De=C.default("wp.impex.dashboard.screen");De("loaded");var Le=typeof window.showDirectoryPicker=="function";function fe(){return window.wp.element.createElement("div",null,window.wp.element.createElement("h1",null,o("Impex","cm4all-wp-impex")),window.wp.element.createElement(t.SlotFillProvider,null,window.wp.element.createElement(t.Flex,{direction:"row",align:"top"},window.wp.element.createElement(t.FlexItem,{isBlock:!0},window.wp.element.createElement(ae,null)),window.wp.element.createElement(t.FlexItem,{isBlock:!0},window.wp.element.createElement(le,null))),window.wp.element.createElement(t.Slot,{name:"progress"}),!Le&&window.wp.element.createElement(t.Modal,{title:"Ouch - your browser does not support the File System Access API :-(",isDismissible:!1},window.wp.element.createElement("p",null,"ImpEx Import / Export requires a browser implementing the"," ",window.wp.element.createElement("a",{href:"https://web.dev/file-system-access/"},"File System Access API"),"."),window.wp.element.createElement("p",null,"Currently only Chromium based browsers like Chrome, Chromium, MS Edge are known to support this feature."),window.wp.element.createElement("p",null,"See"," ",window.wp.element.createElement("a",{href:"https://caniuse.com/mdn-api_window_showdirectorypicker"},"here")," ","to find the latest list of browsers supporting the"," ",window.wp.element.createElement("a",{href:"https://web.dev/file-system-access/"},"File System Access API")," ","feature."))))}var Fe=C.default("wp.impex.dashboard");Fe("loaded");document.querySelector(".notice.notice-error")||m.render(window.wp.element.createElement(de,null,window.wp.element.createElement(fe,null)),document.getElementById("cm4all_wp_impex_wp_admin_dashboard"));})();
/*!
  Copyright (c) 2018 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
